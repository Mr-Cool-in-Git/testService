{% extends "layout.html" %}

    {% block content %}
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
<!--    <link rel="stylesheet" href="https://bootstraptema.ru/plugins/2015/bootstrap3/bootstrap.min.css" />-->
<!--    <link rel="stylesheet" href="https://bootstraptema.ru/plugins/2016/bdt/style.css" />-->
<!--    <link rel="stylesheet" href="https://bootstraptema.ru/plugins/2016/bdt/jquery.bdt.min.css" />-->
<!--    <script src="https://bootstraptema.ru/plugins/jquery/jquery-1.11.3.min.js"></script>-->
<!--    <script src="https://bootstraptema.ru/plugins/2015/b-v3-3-6/bootstrap.min.js"></script>-->
<!--    <script src="https://bootstraptema.ru/plugins/2016/bdt/jquery.sortelements.js" type="text/javascript"></script>-->
<!--    <script src="https://bootstraptema.ru/plugins/2016/bdt/jquery.bdt.min.js" type="text/javascript"></script>-->


    <div class="ui container two column grid">
        <div class="column">
            <input type="text" id="myInput1" onkeyup="myFunction()" placeholder="Доходы">
            <input type="text" id="myInput2" onkeyup="myFunction()" placeholder="Кризисный год">
<!--            <input type="text" id="Input_filter_1" onkeyup="filter_budget()"-->
<!--                placeholder="fact_1"-->
<!--                title="fact_1">-->
<!--            <input type="text" id="Input_filter_2" onkeyup="filter_budget()"-->
<!--                placeholder="fact_2"-->
<!--                title="fact_2">-->
<!--            <input type="text" id="Input_filter_a" onkeyup="filter_budget()"-->
<!--                placeholder="amount"-->
<!--                title="amount">-->
            <table name="Сводная по бюджету" class="ui selectable celled left aligned table table-hover"
                   id="bootstrap-table">
                <thead>
                    <tr>
                        <th>Доходы в прошлом году</th>
                        <th>Кризисный год</th>
                        <th>Бюджет</th>
                        <th>Прогнозное значение</th>
                    </tr>
                </thead>
                <tbody>-->
                    {% for item in items %}-->
                    <TR>
                        <TD class="c1">{{item.fact_1}}</TD>
                        <TD class="c2">{{item.fact_2}}</TD>
                        <TD class="c3"><SPAN>{{item.amount}}</SPAN></TD>
                        {% if item.is_predict==1 %}
                          <TD class="positive"><SPAN>{{item.is_predict}}</SPAN></TD>
                        {% else %}
                          <TD class="negative"><SPAN>{{item.is_predict}}</SPAN></TD>
                        {% endif %}
                    </TR>
                    {% endfor %}
                 </tbody>-->
            </table>
            <script>
            function myFunction() {
              // Declare variables
              var input1, input2, filter1, filter2, table, tr, td, td2, i,
                  txtValue1, txtValue2, totalValue;
              input1 = document.getElementById("myInput1");
              input2 = document.getElementById("myInput2");
              filter1 = input1.value.toUpperCase();
              filter2 = input2.value.toUpperCase();
              table = document.getElementById("bootstrap-table");
              tr = table.getElementsByTagName("tr");

              // Loop through all table rows, and hide those who don't match the search query
              for (i = 0; i < tr.length; i++) {
                  td = tr[i].getElementsByTagName("td")[0];
                  td2 = tr[i].getElementsByTagName("td")[1];

                  if (td && td2) {
                      txtValue1 = (td.textContent || td.innerText);
                      txtValue2 = (td2.textContent || td2.innerText);
                      totalValue = txtValue1 && txtValue2;
                      if (txtValue1.toUpperCase().indexOf(filter1) > -1 && txtValue2.toUpperCase().indexOf(filter2) > -1) {
                          tr[i].style.display = "";
                      } else {
                          tr[i].style.display = "none";
                      }
                  } else {
                      if (td) {
                          totalValue = (td.textContent || td.innerText);
                          if (totalValue.toUpperCase().indexOf(filter1) > -1) {
                              tr[i].style.display = "";
                          } else {
                              tr[i].style.display = "none";
                          }
                      } else {
                          if (td2) {
                              totalValue = (td2.textContent || td2.innerText);
                              if (totalValue.toUpperCase().indexOf(filter2) > -1) {
                                  tr[i].style.display = "";
                              } else {
                                  tr[i].style.display = "none";
                              }
                          }
                      }
                  }
              }
            }
            </script>

            <input type="button" id="btnExport" value="Export" />
            <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js"></script>
            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
            <script type="text/javascript">
                    $("body").on("click", "#btnExport", function () {
                        html2canvas($('#bootstrap-table')[0], {
                            onrendered: function (canvas) {
                                var data = canvas.toDataURL();
                                var docDefinition = {
                                    content: [{
                                        image: data
                                    },
                                    {
                                        image: data
                                    }]
                                };
                                pdfMake.createPdf(docDefinition).download("customer-details.pdf");
                            }
                        });
                    });
            </script>


            <!--            <script>-->
<!--                const filter_budget = () => {-->
<!--                    const columns = [-->
<!--                        { name: 'fact_1', index: 0, isFilter: true },-->
<!--                        { name: 'fact_2', index: 1, isFilter: true },-->
<!--                        { name: 'amount', index: 2, isFilter: true },-->
<!--                    ]-->
<!--                    const filterColumns = columns.filter(c => c.isFilter).map(c => c.index)-->
<!--                    const trs = document.querySelectorAll(`#bootstrap-table tr:not(.header)`)-->
<!--                    const filter_1 = document.querySelector('#Input_filter_1').value-->
<!--                    const filter_2 = document.querySelector('#Input_filter_2').value-->
<!--                    const filter_a = document.querySelector('#Input_filter_a').value-->
<!--                    const regex = new RegExp(escape(filter_1), 'i')-->
<!--                    const isFoundInTds = td => regex.test(td.innerHTML)-->
<!--                    const isFound = childrenArr => childrenArr.some(isFoundInTds)-->
<!--                    const setTrStyleDisplay = ({ style, children }) => {-->
<!--                    style.display = isFound([-->
<!--                        ...filterColumns.map(c => children[c]) // <&#45;&#45; filter Columns-->
<!--                        ]) ? '' : 'none'-->
<!--                    }-->
<!--                    trs.forEach(setTrStyleDisplay)-->
<!--                }-->
<!--            </script>-->
<!--            <script>-->
<!--             $(document).ready( function () {-->
<!--             $('#bootstrap-table').bdt();-->
<!--             });-->
<!--            </script>-->
        </div>
        <div class="wide column chart" id="bargraph" style="width: 570px; height:500px; margin-top: 30px">
            <div>
                <script>
                    var graphs = {{plot | safe}};
                    var layout = {
                        title: 'Годовой бюджет (руб.)',
                    };
                    Plotly.plot('bargraph',graphs,layout);
                </script>
            </div>
            <div style="margin-top: 50px; padding-bottom: 100px">
                <table class="ui selectable celled left aligned table table-hover">
                    <thead>
                        <tr>
                            <th>Отклонения в бюджете</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}
                        <TR>
                            {% if item.amount<0 %}
                              <TD class="negative"><SPAN>Отрицательный бюджет {{item.amount}}</SPAN></TD>
                            {% endif %}
                        </TR>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% endblock %}



